@page "/setting"
@using Microsoft.Extensions.Localization
@using WBPR.Service.Interfaces
@using WBPR.Service.Models.Common
@using WBPR.Service.Services
@inject IStringLocalizer<Setting> langLoc
@inject ISettingService settingService
@inject GraphClientUtilService graphClientUtil

<PageTitle>WBPR - @langLoc["PageTitle"]</PageTitle>

<MudStack AlignItems="AlignItems.Center">

    <MudText Typo="Typo.h5">@langLoc["Appearance"]</MudText>
    <MudItem>
        <MudPaper Class="pa-4" Elevation="4">
            
            <MudSwitch Checked="@(blazorUiInfo==null?false:blazorUiInfo.IsDarkMode)"
                       Label="@langLoc["DarkMode"]" Color="Color.Primary" 
                       CheckedChanged="@(async(value)=>await SetDarkMode(value))" T="bool" />
        </MudPaper>
    </MudItem>

    <MudText Typo="Typo.h5">@res</MudText>
</MudStack>

@code {
    [CascadingParameter]
    protected BlazorUiInfo blazorUiInfo { get; set; }

    private string res = "";

    //protected override async Task OnAfterRenderAsync(bool firstRender)
    //{
    //    if(firstRender)
    //    {
    //        res = await graphClientUtil.GetRoot();
    //    }
    //}

    private async Task SetDarkMode(bool value)
    {
        blazorUiInfo.IsDarkMode = value;
        await settingService.SetDarkTheme(value);
        StateHasChanged();
    }
}
